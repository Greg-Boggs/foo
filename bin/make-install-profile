#!/bin/bash
if [ -z "$1" -o -z "$2" -o -z "$3" -o -z "$4" ]; then
  echo "Usage: $0 <machine_name> <theme_name> <Project Name> <Project Description>"
  echo "Ex: $0 client_xyz xyz_foobar \"Web app ABC\" \"Client XYZ's ABC app enables users to browse a database of records.\""
  exit 1
fi

if [ ! -d os_project ]; then
  echo "Error: Cannot find os_project directory"
  exit 2
fi

PROFILE="$1"
THEME="$2"
PROJECTNAME="$3"
DESCRIPTION="$4"

# rebuild script
sed -i "s/PROFILE=\"os_project\"/PROFILE=\"$PROFILE\"/" bin/rebuild
sed -i "s/PROJECT/$PROJECTNAME/" bin/rebuild
sed -i "s/os_theme/$THEME/" bin/rebuild

# deploy script
sed -i "s/INSTALLPROFILE=os_project/INSTALLPROFILE=$PROFILE/" bin/deploy_to_test

mv os_project $PROFILE
cd $PROFILE
sed -i "s/os_project/$PROFILE/" os_project.*
sed -i "s/PROJECTNAME/$PROJECTNAME/" os_project.*
sed -i "s/DESCRIPTION/$DESCRIPTION/" os_project.*
mv os_project.info    $PROFILE.info
mv os_project.install $PROFILE.install
mv os_project.make    $PROFILE.make
mv os_project.profile $PROFILE.profile
# demo content feature
for ext in deploy_plans.inc features.inc features.uuid_entities.inc info module; do
  sed -i "s/os_project_demo_content/$PROFILE\_demo_content/" modules/features/os_project_demo_content/os_project_demo_content.$ext
  sed -i "s/PROJECT/$PROJECTNAME/" modules/features/os_project_demo_content/os_project_demo_content.$ext
  mv modules/features/os_project_demo_content/os_project_demo_content.$ext modules/features/os_project_demo_content/$PROFILE\_demo_content.$ext
done
mv modules/features/os_project_demo_content modules/features/$PROFILE\_demo_content
