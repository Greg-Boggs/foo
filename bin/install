#!/bin/bash
#
# Runs site-install from drush then enables some local modules
#
# To use this command you must have Drush installed.
#
source bin/.config

#run the rebuild script
bin/rebuild

if ! ( test -e drupal ); then
  echo "I didn't find a drupal directory. Are you sure it exists?"
  exit 1
fi

# Site install.
if [[ -e db/production_current.sql.gz ]]; then
  cd db
  ./db_load.sh production_current.sql.gz
  cd -
else
  cd drupal
  drush site-install -y --uri=default $PROFILE
  drush fra -y
  drush cc all
  cd -
fi

# Enable modules I use locally every time.
# TODO read this from local config instead of hard-coding.
# TODO use drush aliases
cd drupal
drush en diff -y
drush en views_ui -y
drush en styleguide -y
cd -

cd bdd
if ( test -e behat.local.yml ); then
  bin/behat
fi
