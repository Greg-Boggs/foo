#!/bin/bash
#
# Runs site-install from drush then enables some local modules
#
# To use this command you must have Drush installed.
#
if [ -z "$1" ]; then
  echo "Need one argument: name of profile to install."
  echo "Example: bin/local_site_install foo_base"
  exit 1
fi

PROFILE=$1
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

if ! ( test -e $DIR/../$PROFILE ); then
  echo "I didn't find the profile $PROFILE. Are you sure it exists?"
  exit 1
fi

#run the rebuild script
bin/rebuild

if ! ( test -e $DIR/../drupal ); then
  echo "I didn't find a drupal directory. Are you sure it exists?"
  exit 1
fi

cd $DIR/../drupal

# Site install
drush site-install -y --uri=default $PROFILE

# Enable modules I use locally every time.
drush en diff -y
drush en views_ui -y
drush en styleguide -y

cd ../bdd
if ( test -e bin/behat ); then
  bin/behat
fi
